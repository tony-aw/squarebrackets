cp_seq(x, 0, by = 0),
pattern = "`by` cannot be zero",
fixed = TRUE
)
enumerate <- enumerate + 6
# error checks - bad start/end:
x <- matrix(1:10, ncol = 2)
expect_error(
cp_seq(x, 1, from = 1, to = 6),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = 6 * -1 |> bi(), to = 6),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = NA_integer_, to = 4),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = 1L, to = NA_integer_),
pattern = "index out of bounds"
)
# error checks - bad start/end:
x <- matrix(1:10, ncol = 2)
expect_error(
cp_seq(x, 1, from = 1, to = 6),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = 6 * -1, to = 6),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = NA_integer_, to = 4),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = 1L, to = NA_integer_),
pattern = "index out of bounds"
)
expect_error(
cp_seq(x, 1, from = 1, to = 6 * -1),
pattern = "index out of bounds"
)
enumerate <- enumerate + 6
setwd("D:/D Desktop/Publications/R package squarebrackets/squarebrackets/inst/tinytest/slice")
sys.source(file.path(getwd(), "source", "functions4testing.R"), envir = environment())
enumerate <- 0
# argument i ====
x <- 1:10
slice_start <- c(
1, 2, -1, -2
) |> bi()
seq_start <- c(
1, 2, length(x), length(x) - 1
)
slice_end <- c(
1, 2, -1, -2
) |> bi()
tinytest::run_test_dir("./squarebrackets/inst/tinytest/slice")
# set-up ====
setwd("D:/D Desktop/Publications/R package squarebrackets")
sessionInfo()
pkgs <- c("devtools", "roxygen2", "usethis", "rcmdcheck", "spelling", "tinytex",
"tinytest",
"Rcpp", "pkgdown", "tinytest")
for(i in pkgs) if(!requireNamespace(i))install.packages(i)
library(tinytest)
# install(file.path("D:/D Desktop/Publications/ImageMagick-7.1.0-62-Q16-HDRI-x64-dll"))
# tinytex::install_tinytex()
# tinytex::tlmgr_install("unfonts-extra")
# tinytex::tlmgr_install("makeindex")
#  create("squarebrackets")
# Rcpp::Rcpp.package.skeleton("squarebrackets")
# set version ====
package_tarname <- "squarebrackets_0.0.0.9006.tar.gz"
# document ====
Rcpp::compileAttributes("squarebrackets")
devtools::document("./squarebrackets")
tinytest::run_test_dir("./squarebrackets/inst/tinytest/slice")
list_fromto <- list(
1, 100, 2, 99, 10, 90, 100, 1, 99, 2, 98, 3
)
list_by <- list(
1, 2, 3, 100, -1, -2, -3, -100
)
n <- length(list_fromto) * length(list_fromto) * length(list_by)
# equal length replacement ====
x <- mutatomic(1:100)
expected <- out <- vector("list", n)
counter <- 1L
for(iF in seq_along(list_fromto)) {
for(iT in seq_along(list_fromto)) {
for(iB in seq_along(list_by)) {
from = list_fromto[[iF]]
to = list_fromto[[iT]]
by = list_by[[iB]]
rp <- subset_fun(x, from, to, by)
expected[[counter]] <- basetest(x, from, to, by, tf = \(x) as.integer(x^2))
out[[counter]] <- slicetest(x, from, to, by, tf = \(x) x^2)
counter <- counter + 1L
enumerate <- enumerate + 1L
}
}
}
# set-up ====
setwd("D:/D Desktop/Publications/R package squarebrackets")
sessionInfo()
pkgs <- c("devtools", "roxygen2", "usethis", "rcmdcheck", "spelling", "tinytex",
"tinytest",
"Rcpp", "pkgdown", "tinytest")
for(i in pkgs) if(!requireNamespace(i))install.packages(i)
library(tinytest)
# install(file.path("D:/D Desktop/Publications/ImageMagick-7.1.0-62-Q16-HDRI-x64-dll"))
# tinytex::install_tinytex()
# tinytex::tlmgr_install("unfonts-extra")
# tinytex::tlmgr_install("makeindex")
#  create("squarebrackets")
# Rcpp::Rcpp.package.skeleton("squarebrackets")
# set version ====
package_tarname <- "squarebrackets_0.0.0.9006.tar.gz"
# document ====
Rcpp::compileAttributes("squarebrackets")
devtools::document("./squarebrackets")
tinytest::run_test_dir("./squarebrackets/inst/tinytest/slice")
tinytest::run_test_dir("./squarebrackets/inst/tinytest/slice")
# set-up ====
setwd("D:/D Desktop/Publications/R package squarebrackets")
sessionInfo()
pkgs <- c("devtools", "roxygen2", "usethis", "rcmdcheck", "spelling", "tinytex",
"tinytest",
"Rcpp", "pkgdown", "tinytest")
for(i in pkgs) if(!requireNamespace(i))install.packages(i)
library(tinytest)
# install(file.path("D:/D Desktop/Publications/ImageMagick-7.1.0-62-Q16-HDRI-x64-dll"))
# tinytex::install_tinytex()
# tinytex::tlmgr_install("unfonts-extra")
# tinytex::tlmgr_install("makeindex")
#  create("squarebrackets")
# Rcpp::Rcpp.package.skeleton("squarebrackets")
# set version ====
package_tarname <- "squarebrackets_0.0.0.9006.tar.gz"
# document ====
Rcpp::compileAttributes("squarebrackets")
devtools::document("./squarebrackets")
tinytest::run_test_dir("./squarebrackets/inst/tinytest/slice")
dirs <- list.dirs("./squarebrackets/inst/tinytest/")
for(i in dirs) {
print(i)
foo <- tinytest::run_test_dir(i)
if(!all_pass(foo)) {
stop("not all pass")
}
}
# set-up ====
setwd("D:/D Desktop/Publications/R package squarebrackets")
sessionInfo()
pkgs <- c("devtools", "roxygen2", "usethis", "rcmdcheck", "spelling", "tinytex",
"tinytest",
"Rcpp", "pkgdown", "tinytest")
for(i in pkgs) if(!requireNamespace(i))install.packages(i)
library(tinytest)
# install(file.path("D:/D Desktop/Publications/ImageMagick-7.1.0-62-Q16-HDRI-x64-dll"))
# tinytex::install_tinytex()
# tinytex::tlmgr_install("unfonts-extra")
# tinytex::tlmgr_install("makeindex")
#  create("squarebrackets")
# Rcpp::Rcpp.package.skeleton("squarebrackets")
# set version ====
package_tarname <- "squarebrackets_0.0.0.9006.tar.gz"
# document ====
Rcpp::compileAttributes("squarebrackets")
devtools::document("./squarebrackets")
tinytest::run_test_dir("./squarebrackets/inst/tinytest/slice")
setwd("D:/D Desktop/Publications/R package squarebrackets/squarebrackets/inst/tinytest/generic")
enumerate <- 0 # to count number of tests in loops
source(file.path(getwd(), "source", "functions4testing.R"))
test_allow_duplicates <- FALSE
test_use_factors <- FALSE
test_PassByReference <- FALSE
temp.fun <- function(x) {
tempfun <- function(x) {
x[] <- x[1]
return(x)
}
expect_equal(
ii_mod(x, rp = x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
temp.fun <- function(x) {
tempfun <- function(x) {
x[] <- x[1]
return(x)
}
expect_equal(
ss_mod(x, rp = x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
test_sb <- function(x, i, rp) {
i <- indx_x(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1, length(indx_x(elements[[i]], x, names(x), length(x))))
expect_equal(
ii_mod(x, i = elements[[i]], rp = rp1),
test_sb(x, i = elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i, rp) {
i <- indx_wo(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1, length(indx_x(elements[[i]], x, names(x), length(x))))
expect_equal(
ii_mod(x, elements[[i]], -1, rp = rp1),
test_sb(x, elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i, rp) {
i <- indx_wo(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1, length(indx_wo(elements[[i]], x, names(x), length(x))))
expect_equal(
ii_mod(x, elements[[i]], -1, rp = rp1),
test_sb(x, elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
enumerate <- 0 # to count number of tests in loops
source(file.path(getwd(), "source", "functions4testing.R"))
test_allow_duplicates <- FALSE
test_use_factors <- FALSE
test_PassByReference <- FALSE
temp.fun <- function(x) {
tempfun <- function(x) {
x[] <- x[1]
return(x)
}
expect_equal(
ii_mod(x, tf = \(x)x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
temp.fun <- function(x) {
tempfun <- function(x) {
x[] <- x[1]
return(x)
}
expect_equal(
ss_mod(x, tf = \(x)x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
test_sb <- function(x, i) {
if(!is.list(x)) {
i <- indx_x(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- min(x[i])
return(x)
}
if(is.list(x)) {
i <- indx_x(i, x, names(x), length(x))
if(length(i) == 0) return(x)
if(length(i) != 1)  x[i] <- lapply(x[i], min)
if(length(i) == 1) x[[i]] <- min(x[[i]])
return(x)
}
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
expect_equal(
ii_mod(x, i = elements[[i]], tf = min),
test_sb(x, i = elements[[i]])
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i) {
i <- indx_wo(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- min(x[i])
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
expect_equal(
ii_mod(x, elements[[i]], -1, tf = min),
test_sb(x, elements[[i]])
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
enumerate <- 0 # to count number of tests in loops
source(file.path(getwd(), "source", "functions4testing.R"))
test_allow_duplicates <- FALSE
test_use_factors <- FALSE
test_PassByReference <- TRUE
ii_set2 <- function(x, ...) {
x <- data.table::copy(x)
if(is.atomic(x)) x <- as.mutatomic(x)
x2 <- x
ii_set(x, ...)
if(!identical(x, x2)) { stop("PassByReference fail")}
return(x)
}
ss_set2 <- function(x, ...) {
x <- data.table::copy(x)
if(is.atomic(x)) x <- as.mutatomic(x)
x2 <- x
ss_set(x, ...)
if(!identical(x, x2)) { stop("PassByReference fail")}
return(x)
}
temp.fun <- function(x) {
tempfun <- function(x) {
x <- as.mutatomic(x)
x[] <- x[1]
return(x)
}
expect_equal(
ii_set2(x, rp = x[1]),
tempfun(x)
) |> errorfun()
}
temp.fun <- function(x) {
tempfun <- function(x) {
x <- as.mutatomic(x)
x[] <- x[1]
return(x)
}
expect_equal(
ii_set2(x, rp = x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
temp.fun <- function(x) {
tempfun <- function(x) {
x <- as.mutatomic(x)
x[] <- x[1]
return(x)
}
expect_equal(
ss_set2(x, rp = x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
test_sb <- function(x, i, rp) {
if(is.atomic(x)) x <- as.mutatomic(x)
i <- indx_x(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1L, length(indx_x(elements[[i]], x, names(x), length(x))))
if(is.list(x)) rp1 <- as.list(rp1)
if(is.list(x) && length(rep) != 1) rp2 <- as.list(rp)
expect_equal(
ii_set2(x, i = elements[[i]], rp = rp1),
test_sb(x, i = elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i, rp) {
if(is.atomic(x)) x <- as.mutatomic(x)
i <- indx_wo(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1L, length(indx_x(elements[[i]], x, names(x), length(x))))
expect_equal(
ii_set2(x, elements[[i]], -1, rp = rp1),
test_sb(x, elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i, rp) {
if(is.atomic(x)) x <- as.mutatomic(x)
i <- indx_x(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1L, length(indx_x(elements[[i]], x, names(x), length(x))))
if(is.list(x)) rp1 <- as.list(rp1)
if(is.list(x) && length(rep) != 1) rp2 <- as.list(rp)
expect_equal(
ii_set2(x, i = elements[[i]], rp = rp1),
test_sb(x, i = elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i, rp) {
if(is.atomic(x)) x <- as.mutatomic(x)
i <- indx_wo(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- rp
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
rp1 <- rp2 <- rep(1L, length(indx_wo(elements[[i]], x, names(x), length(x))))
expect_equal(
ii_set2(x, elements[[i]], -1, rp = rp1),
test_sb(x, elements[[i]], rp = rp2)
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
temp.fun <- function(x) {
tempfun <- function(x) {
x <- as.mutatomic(x)
x[] <- x[1]
return(x)
}
expect_equal(
ii_set2(x, tf = \(x)x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
temp.fun <- function(x) {
tempfun <- function(x) {
x <- as.mutatomic(x)
x[] <- x[1]
return(x)
}
expect_equal(
ss_set2(x, tf = \(x)x[1]),
tempfun(x)
) |> errorfun()
}
sys.source(file.path(getwd(), "source", "sourcetest-missingargs.R"), envir = environment())
test_sb <- function(x, i) {
if(is.atomic(x)) x <- as.mutatomic(x)
i <- indx_x(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- min(x[i])
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
expect_equal(
ii_set2(x, i = elements[[i]], tf = min),
test_sb(x, i = elements[[i]])
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
test_sb <- function(x, i) {
if(is.atomic(x)) x <- as.mutatomic(x)
i <- indx_wo(i, x, names(x), length(x))
if(length(i) == 0) return(x)
x[i] <- min(x[i])
return(x)
}
temp.fun <- function(x, elements) {
for (i in 1:length(elements)) {
expect_equal(
ii_set2(x, elements[[i]], -1, tf = min),
test_sb(x, elements[[i]])
) |> errorfun()
assign("enumerate", enumerate + 1, envir = parent.frame(n = 1))
}
}
sys.source(file.path(getwd(), "source", "sourcetest-elements.R"), envir = environment())
